---
title: "fig2a2b"
output: html_document
date: "2024-07-28"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r,warning=FALSE,fig.height=8,fig.width=9}
setwd("/Users/yangjianxia/Desktop/npj.code/Fig1.Fig2.Figs1")
## 模拟
## 导入包
library(ggplot2)
library(reshape2)
library(RColorBrewer)
rm(list = ls())
## 载入数据
ID0 <- read.csv("Mydata.csv", head = T, row.names = 1)
df <- ID0
col11<-c("violet","cyan","dodgerblue",
         "thistle1","tomato","turquoise", "violet", 
         "yellowgreen","peachpuff", "peru", "pink", "plum2", "purple","wheat", "cornsilk3","cornsilk",
         "coral4","coral","chocolate4","chocolate","black","chartreuse4","chartreuse","burlywood4","burlywood",
         "brown4","bisque4","bisque","azure4","azure","aquamarine4","aquamarine","antiquewhite4","antiquewhite",
         "aliceblue","dodgerblue4","dodgerblue","dimgrey","deepskyblue4", "deepskyblue", "deeppink4", "deeppink","darkviolet",
         "darkslategray4","darkslategray","darkseagreen4", "darkseagreen", "darksalmon", "darkred", "darkorchid4", "darkorchid",
         "darkorange4", "darkorange","firebrick","darkgreen","darkgoldenrod4", "darkgoldenrod", "darkcyan","cyan")
## 统计数据均值、标准差、标准误
mean <- aggregate(df$IN, by=list(df$Nadd, df$Nlevel), FUN=mean)
sd <- aggregate(df$IN, by=list(df$Nadd, df$Nlevel), FUN=sd)
len <- aggregate(df$IN, by=list(df$Nadd, df$Nlevel), FUN=length)
df_res <- data.frame(mean, sd=sd$x, len=len$x)
colnames(df_res) = c("Nadd", "Nlevel", "Mean", "Sd", "Count")
str(df_res)
df_res$Se <- df_res$Sd/sqrt(df_res$Count) ### 计算标准差


selected_rows<-c(2,13,14)
selected_data<-df_res[selected_rows,]
selected_data$Treatment<-paste(selected_data$Nadd,selected_data$Nlevel,sep="N")
selected_data$Treatment<-factor(selected_data$Treatment,levels = c("NcontN0","NcontN50","NcessN50"),order=T)
selected_data$Treatment<-factor(selected_data$Treatment,labels = c("Control","Ncont","Ncess"),order=T)

### ggplot 绘图 (标准差：误差线)
l<-ggplot(selected_data, aes(x=Treatment, y=Mean, fill=Treatment)) +
  geom_bar(stat="identity", position=position_dodge(),color="black", width=.6) +
  scale_fill_manual(values = col11) +
  geom_errorbar(aes(ymin=Mean-Sd, ymax=Mean +Sd),position=position_dodge(.6), width=.2)+
  ylim(0,600)+
  labs(x="")+
  ylab(bquote('Soil available nitrogen ('*mg~kg ^-1*')'))+theme_bw()+
  theme(text=element_text(size=15,  family="sans"))+
  theme(legend.title = element_text(colour="black", size=15),
        legend.text = element_text(colour="black", size=15),
        legend.position="none",
        axis.text=element_text(colour="black",size=30),
        axis.title=element_text(colour="black",size=30))
p1<-l+theme(panel.border = element_rect(fill = NA,color = "black",size=1.5,linetype = "solid"))
p1
#ggsave("fig2a.2017_2019_N.pdf",width = 9,height = 8)



setwd("/Users/yangjianxia/Desktop/npj.data.code/Fig1.fig2.figs1")
## 模拟
## 导入包
library(ggplot2)
library(reshape2)
library(RColorBrewer)
rm(list = ls())
## 载入数据
ID0 <- read.csv("Mydata.csv", head = T, row.names = 1)
df <- ID0
#mycol= brewer.pal(n = 12, name = "Set3")
col11<-c("violet","cyan","dodgerblue","thistle1","tomato","turquoise", "violet", 
         "yellowgreen","peachpuff", "peru", "pink", "plum2", "purple","wheat", "cornsilk3","cornsilk",
         "coral4","coral","chocolate4","chocolate","black","chartreuse4","chartreuse","burlywood4","burlywood",
         "brown4","bisque4","bisque","azure4","azure","aquamarine4","aquamarine","antiquewhite4","antiquewhite",
         "aliceblue","dodgerblue4","dodgerblue","dimgrey","deepskyblue4", "deepskyblue", "deeppink4", "deeppink","darkviolet",
         "darkslategray4","darkslategray","darkseagreen4", "darkseagreen", "darksalmon", "darkred", "darkorchid4", "darkorchid",
         "darkorange4", "darkorange","firebrick","darkgreen","darkgoldenrod4", "darkgoldenrod", "darkcyan","cyan")
## 统计数据均值、标准差、标准误
mean <- aggregate(df$PH, by=list(df$Nadd, df$Nlevel), FUN=mean)
sd <- aggregate(df$PH, by=list(df$Nadd, df$Nlevel), FUN=sd)
len <- aggregate(df$PH, by=list(df$Nadd, df$Nlevel), FUN=length)
df_res <- data.frame(mean, sd=sd$x, len=len$x)
colnames(df_res) = c("Nadd", "Nlevel", "Mean", "Sd", "Count")
str(df_res)
df_res$Se <- df_res$Sd/sqrt(df_res$Count) ### 计算标准差


selected_rows<-c(2,13,14)
selected_data<-df_res[selected_rows,]
selected_data$Treatment<-paste(selected_data$Nadd,selected_data$Nlevel,sep="N")

selected_data$Treatment<-factor(selected_data$Treatment,levels = c("NcontN0","NcontN50","NcessN50"),order=T)
selected_data$Treatment<-factor(selected_data$Treatment,labels = c("Control","Ncont","Ncess"),order=T)

### ggplot 绘图 (标准差：误差线)
l<-ggplot(selected_data, aes(x=Treatment, y=Mean, fill=Treatment)) +
  geom_bar(stat="identity", position=position_dodge(),color="black", width=.6) +
  scale_fill_manual(values = col11) +
  geom_errorbar(aes(ymin=Mean-Sd, ymax=Mean +Sd),position=position_dodge(.6), width=.2)+
  ylim(0,8)+
  labs(x="")+
  ylab(bquote('Soil pH'))+theme_bw()+
  theme(text=element_text(size=15,  family="sans"))+
  theme(legend.title = element_text(colour="black", size=15),
        legend.text = element_text(colour="black", size=15),
        legend.position = "none",
        axis.text=element_text(colour="black",size=30),
        axis.title=element_text(colour="black",size=30))
p1<-l+theme(panel.border = element_rect(fill = NA,color = "black",size=1.5,linetype = "solid"))
p1
#ggsave("fig2b.2017_2019_PH.pdf",width = 9,height = 8)
library(vegan)
library(pheatmap)
library(colorRamps)
library(ggplot2)
library(vegan)
library(PMCMRplus)
library(nlme)
library(agricolae)
library(splitstackshape)
library(ggh4x) #facet_grid axis independent
library(colorRamps)
datap <- read.csv("statistic.csv", head = T, row.names = 1)
datap$LIN<-log10(datap$IN)
kruskal_rlt <- function(y, trt) {
  kru_rlt <- kruskal(y, trt, p.adj = "bonferroni")
  kru_lab <- data.frame(
    grp = rownames(kru_rlt$groups),
    sig_lab = kru_rlt$groups$groups
  )
  return(kru_lab)
} 
kruskal.test(datap$IN ~ datap$treatment)
kruskal_rlt(datap$IN,datap$treatment)
mode2<-aov(IN ~ treatment,data=datap)
summary(mode2)
model2lsd<-LSD.test(mode2,"treatment",p.adj="bonferroni")
model2lsd$groups

kruskal_rlt <- function(y, trt) {
  kru_rlt <- kruskal(y, trt, p.adj = "bonferroni")
  kru_lab <- data.frame(
    grp = rownames(kru_rlt$groups),
    sig_lab = kru_rlt$groups$groups
  )
  return(kru_lab)
} 
kruskal.test(datap$PH ~ datap$treatment)
kruskal_rlt(datap$PH,datap$treatment)
mode2<-aov(PH ~ treatment,data=datap)
summary(mode2)
model2lsd<-LSD.test(mode2,"treatment",p.adj="bonferroni")
model2lsd$groups
```